# BlackPiyan 使用指南

本文檔提供 BlackPiyan（21點莊家策略模擬工具）的詳細使用說明，涵蓋基本操作、配置和結果解讀。

## 目錄

1. [基本介紹](#基本介紹)
2. [快速開始](#快速開始)
3. [程序結構](#程序結構)
4. [功能說明](#功能說明)
5. [運行模式](#運行模式)
6. [結果解讀](#結果解讀)
7. [圖表說明](#圖表說明)
8. [進階使用](#進階使用)

## 基本介紹

BlackPiyan 是一個專門用於模擬和分析21點（Blackjack）遊戲中莊家不同補牌策略的工具。通過模擬大量遊戲局數，收集和分析莊家在不同補牌策略下的點數分布、爆牌率等數據，幫助用戶理解不同策略的表現差異。

### 主要功能

- 模擬莊家在不同補牌策略下的表現
- 收集和分析莊家點數分布數據
- 生成可視化圖表展示分析結果
- 比較不同策略的表現差異

## 快速開始

### 運行基本模擬

使用默認配置運行模擬：

```bash
python main.py
```

這將使用 `configs/default.yaml` 中的配置進行模擬，並在 `results/charts/` 目錄下生成圖表。

### 使用自定義配置

創建自己的配置文件：

1. 複製默認配置文件：
   ```bash
   cp configs/default.yaml configs/my_config.yaml
   ```

2. 使用文本編輯器修改配置文件

3. 運行模擬時指定自定義配置：
   ```bash
   python main.py --config configs/my_config.yaml
   ```

## 程序結構

BlackPiyan 的主要組成部分：

- **模擬器 (Simulator)**：進行遊戲模擬
- **分析器 (Analyzer)**：分析模擬結果
- **視覺化器 (Visualizer)**：生成圖表
- **配置管理器 (ConfigManager)**：管理配置參數

## 功能說明

### 莊家策略模擬

BlackPiyan 模擬莊家在不同「停牌點」下的表現：

- 莊家補牌規則：當點數小於策略值時補牌，否則停牌
- 每種策略模擬大量局數（默認至少1000局）
- 收集莊家最終點數的分布數據

### 策略比較分析

比較不同策略的差異：

- 爆牌率（超過21點的機率）
- 平均點數
- 中位數點數
- 標準差（點數分布的離散程度）

### 圖表生成

生成多種可視化圖表：

- 單一策略的點數分布圖
- 不同策略的比較圖表
- 包含爆牌率、平均點數、標準差等指標的比較

## 運行模式

BlackPiyan 支持多種運行模式：

### 基本模式

```bash
python main.py
```

使用默認配置進行模擬和分析。

### 指定配置文件

```bash
python main.py --config configs/my_config.yaml
```

使用自定義配置文件運行。

### 僅分析模式

如果已有模擬數據，可以僅運行分析和可視化：

```bash
python main.py --analyze-only
```

### 指定輸出目錄

```bash
python main.py --output results/my_results
```

將結果保存到指定目錄。

## 結果解讀

### 控制台輸出

運行程序後，控制台將輸出以下信息：

- 模擬進度和時間
- 每種策略的基本統計數據（爆牌率、平均點數等）
- 模擬完成信息和圖表保存路徑

### 日誌文件

詳細的模擬過程記錄在日誌文件中，默認位置：`logs/blackpiyan.log`

## 圖表說明

BlackPiyan 生成的主要圖表：

### 點數分布圖

顯示單一策略下莊家最終點數的分布情況。

- X軸：點數值
- Y軸：局數
- 紅色部分：爆牌（>21點）
- 藍色部分：未爆牌（≤21點）
- 綠色垂直線：中位數
- 紫色垂直線：平均值

### 策略比較圖

四個子圖，比較不同策略的表現：

1. **爆牌率比較**：比較各策略的爆牌率
2. **平均點數比較**：比較各策略的平均點數
3. **點數分布比較**：使用折線圖比較點數分布差異
4. **標準差比較**：比較各策略點數的標準差

## 進階使用

### 自定義模擬參數

修改配置文件中的以下參數：

- `game.decks`：使用的牌副數量
- `game.reshuffle_threshold`：洗牌閾值
- `simulation.min_games_per_strategy`：每種策略的最少模擬局數
- `simulation.strategies`：要測試的策略列表

### 自定義字體

如果需要在圖表中使用特定字體（特別是中文字體），可以修改配置文件：

```yaml
font:
  family: "字體名稱"   # 主要字體
  fallback: "後備字體"  # 後備字體
```

如需更詳細的字體設置說明，請參考[跨平台字體支持](./font_support.md)文檔。

### 擴展策略範圍

默認配置測試了莊家在16、17、18點停牌的策略。如需測試更多策略，修改配置文件：

```yaml
simulation:
  strategies:
    - 15
    - 16
    - 17
    - 18
    - 19
```

---

如果您對 BlackPiyan 的功能有任何疑問，或需要更多使用說明，請參考其他文檔或在 GitHub 項目頁面提問。 